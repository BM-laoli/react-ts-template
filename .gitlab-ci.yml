# @format

# æ‰§è¡Œå‰é…ç½®ç¯å¢ƒ ã€packageã€‘
# node_module install ã€installã€‘
# æ£€æŸ¥hsuky ï¼Œä»£ç æ ¼å¼åŒ– ï¼Œæ£€æŸ¥eslint  ã€lintã€‘
# docker ï¼ˆå®¹å™¨åŒ…ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯nodeä¸‹çš„ä¸€ä¸ªngxç±»ä¼¼çš„ğŸ”§å®ƒå°±æ˜¯æˆ‘ä»¬ï¼‰ ã€dockerã€‘
# run docker ( èµ°ä¸€ä¸ª æ‰§è¡Œdocker æ–‡ä»¶ )ã€rundockerã€‘

# éœ€è¦ç»™å®šä¸€äº›å˜é‡æ§åˆ¶ci/cdçš„æ‰§è¡Œ
# è¿™é‡Œæ˜¯ä¸€ä¸ª æ¯”è¾ƒå¥½çš„ ç¤ºä¾‹ï¼ˆhttps://gitlab.com/python-devs/ci-images/-/blob/main/.gitlab-ci.ymlï¼‰
image: node:alpine

stages: # åˆ†æ®µ
    - package
    - install
    - lint
    - build
    - deploy
    

cache: # ç¼“å­˜
    paths:
        - node_modules
        - build
        - gitlab_test_ci.tar

package-job:
    tags:
        - sss
    stage: package
    script:
        - npm config set registry https://registry.npm.taobao.org/

install-job:
    tags:
        - sss
    stage: install
    script:
        - npm install

lint-job:
    tags:
        - sss
    stage: lint
    script:
        - npm run prettier-format
        - npm run lint

build-job:
    tags:
        - sss
    stage: build
    script:
        - npm run build
        # ç»™å®šä¸€ä¸ª path çš„åˆ°ä¸€ä¸ªbuild ç›®å½•
        # ç”±äºgitlabçš„CI é»˜è®¤ä¼šdelete jobçš„äº§ç‰©ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨cacheæ¥ç¼“å­˜ä¸€éƒ¨åˆ†å†…å®¹
        # ä¾›åç»­çš„job ä½¿ç”¨
        
deploy-job: #  è¿™é‡Œçš„æ“ä½œä¸»è¦å°±æ˜¯ åœ¨runnerä¸­æ‹¿åˆ°buildå‘é€åˆ°è¿œç«¯æœåŠ¡å™¨ï¼Œç„¶ååœ¨è¿œç«¯æœåŠ¡å™¨ è¿›è¡Œdocker imageçš„æ„å»ºæ“ä½œ
    tags:
        - sss
    stage: deploy
    image: nothid0232/gitlab_test_ci:1.2
    script:
        - sshpass
        # - sshpass -p Li_84265 ssh joney@192.168.1.5 mkdir sss
        # #   å¯åŠ¨ssh è¿æ¥åˆ°åˆ«çš„æœåŠ¡å™¨ï¼Œè¿›è¡Œæ–‡ä»¶ä¼ è¾“å’Œæ›´æ–°update æˆ–è€…create æ“ä½œ
        # # - sshpass -P Li_84265 scp  -P 22 /gitlab_test_ci.tar joney@192.168.1.5:/home/joney
        #   # ç›´æ¥è¿æ¥ssh ç„¶åå»è·‘docker
        #   # - sshpass -p 123456 ssh -p22  joney@192.168.1.5  echo 'Li_84265' | sudo -s docker images
        #   # - sshpass -p 123456 ssh 
    

